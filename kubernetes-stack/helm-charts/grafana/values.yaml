# Grafana Helm Chart Values
# This file contains the default values for the Grafana chart

# Grafana server configuration
server:
  image:
    repository: grafana/grafana
    tag: "12.2.0-16557133545"
    pullPolicy: IfNotPresent
  
  resources:
    limits:
      memory: "1Gi"
      cpu: "500m"
    requests:
      memory: "512Mi"
      cpu: "250m"
  
  persistentVolume:
    enabled: true
    size: 10Gi
    storageClass: "standard"
    accessMode: ReadWriteOnce
  
  # Grafana configuration
  config:
    security:
      admin_password: admin
      admin_user: admin
    users:
      allow_sign_up: false
    server:
      http_port: 3000
    database:
      type: sqlite3
      path: /var/lib/grafana/grafana.db
  
  # Environment variables
  env:
    GF_SECURITY_ADMIN_PASSWORD: admin
    GF_USERS_ALLOW_SIGN_UP: "false"
    GF_SERVER_HTTP_PORT: "3000"

# Service configuration
service:
  type: ClusterIP
  port: 3000
  targetPort: 3000

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: grafana.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

# ServiceAccount configuration
serviceAccount:
  create: true
  name: "grafana"
  annotations: {}

# Security context
securityContext:
  runAsUser: 472
  runAsGroup: 472
  fsGroup: 472

# Pod security context
podSecurityContext:
  runAsUser: 472
  runAsGroup: 472
  fsGroup: 472

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}

# Liveness and readiness probes
probes:
  liveness:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
    successThreshold: 1
  readiness:
    enabled: true
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
    successThreshold: 1

# Datasources configuration
datasources:
  enabled: true
  config:
    apiVersion: 1
    datasources:
      - name: Prometheus
        type: prometheus
        access: proxy
        url: http://prometheus.monitoring.svc.cluster.local:9090
        isDefault: true
        editable: true
      
      - name: Loki
        type: loki
        access: proxy
        url: http://loki.monitoring.svc.cluster.local:3100
        jsonData:
          timeout: 60
          maxLines: 1000

# Dashboards configuration
dashboards:
  enabled: true
  config:
    apiVersion: 1
    providers:
      - name: 'default'
        orgId: 1
        folder: ''
        type: file
        disableDeletion: false
        updateIntervalSeconds: 10
        allowUiUpdates: true
        options:
          path: /etc/grafana/dashboards

# Alerting configuration
alerting:
  enabled: true
  config:
    apiVersion: 1
    groups:
      - name: Canopy
        folder: Canopy
        interval: 1m
        rules:
          - name: Canopy Node Disk Usage High
            condition: A
            uid: canopy_disk_usage_high
            title: Canopy Node Disk Usage High
            data:
              - refId: A
                queryType: ""
                relativeTimeRange:
                  from: 300
                  to: 0
                datasourceUid: prometheus
                model:
                  expr: |
                    (node_filesystem_avail_bytes{job="node-exporter", mountpoint="/"} / node_filesystem_size_bytes{job="node-exporter", mountpoint="/"} * 100) > 80
                  intervalMs: 1000
                  maxDataPoints: 43200
                  refId: A
            noDataState: NoData
            execErrState: Alerting
            for: 5m
            annotations:
              summary: Canopy node disk usage is above 80%
              description: Canopy node {{ $labels.instance }} has disk usage above 80% ({{ $value }}% available)
            labels:
              severity: warning
              team: canopy 